{% extends "layout.html" %}

{% block title %}Detalhes do Chamado{% endblock %}

{% block content %}
    <h1>Detalhes do Chamado #{{ ticket.id[:8] }}...</h1>

    <div class="box-container" style="margin-top: 2rem;">
        <h3>{{ ticket.title }}</h3>
        <p><strong>Status:</strong> {{ ticket.status }}</p>
        <p><strong>Setor:</strong> {{ ticket.sector }}</p>
        <p><strong>Urgência:</strong> {{ ticket.urgency }}</p>
        <p><strong>Descrição:</strong><br>{{ ticket.description|nl2br }}</p>
        {% if ticket.attachment %}
            <p><strong>Anexo:</strong> <a href="{{ url_for('static', filename=ticket.attachment.replace('uploads/', '')) }}" target="_blank">Ver anexo</a></p>
        {% endif %}
    </div>

    <div class="box-container" style="margin-top: 2rem;">
        <h3>Respostas</h3>
        {% if ticket.responses|length > 0 %}
            {% for reply in ticket.responses %}
                <div class="reply" style="border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1rem;">
                    <p><strong>{{ reply.user_email }}</strong> em {{ reply.timestamp.strftime('%d/%m/%Y %H:%M') }}</p>
                    <p>{{ reply.text|nl2br }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p>Nenhuma resposta ainda.</p>
        {% endif %}
        
        <form method="post" style="margin-top: 2rem;">
            <div class="input-group">
                <label for="reply">Adicionar Resposta:</label>
                <textarea id="reply" name="reply" rows="4" required></textarea>
            </div>
            <button type="submit" class="btn">Enviar Resposta</button>
        </form>
    </div>

    <a href="{{ url_for('tickets.list_tickets') }}" class="btn btn-secondary" style="margin-top: 2rem;">Voltar para a Lista</a>
{% endblock %}